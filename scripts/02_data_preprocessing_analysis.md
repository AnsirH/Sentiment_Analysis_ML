# 감정 분석 데이터 전처리 과정 분석 (02_data_preprocess.ipynb)

## 개요
`02_data_preprocess.ipynb` 파일을 통해 수행된 감정 분석 데이터의 전처리 과정을 분석합니다. 이 파일은 주로 감정 라벨 정리와 데이터 품질 관리에 중점을 둡니다.

## 1. 데이터 로딩 및 기본 설정

### 1.1 라이브러리 설정
필요한 라이브러리들을 임포트합니다:
- `pandas`: 데이터 조작 및 분석
- `numpy`: 수치 연산
- `collections.Counter`: 빈도 계산

### 1.2 데이터 로드
`01_dataframe.xlsx` 파일에서 원본 데이터를 로드합니다.

**데이터 구조:**
- 총 1,039개의 행
- 주요 컬럼: `created_date`, `source`, `context`, `annotation`, `__index_level_0__`
- `context`: 감정이 표현된 텍스트 데이터
- `annotation`: JSON 형태의 감정 라벨링 정보

### 1.3 데이터 확인
로드된 데이터의 기본 정보와 처음 몇 행을 확인하여 데이터 구조를 파악합니다.

## 2. 데이터 정리

### 2.1 불필요한 컬럼 제거
분석에 불필요한 컬럼들을 제거합니다:
- `created_date`: 생성 날짜 (분석에 불필요)
- `source`: 데이터 소스 (분석에 불필요)
- `__index_level_0__`: 인덱스 레벨 (불필요)

최종적으로 `context`와 `annotation` 컬럼만 남겨서 감정 분석에 필요한 핵심 데이터만 유지합니다.

### 2.2 정리된 데이터 확인
컬럼 제거 후 데이터의 구조와 내용을 확인하여 정리 작업이 올바르게 수행되었는지 검증합니다.

## 3. 감정 데이터 추출

### 3.1 감정 추출 방식
`annotation` 컬럼의 JSON 문자열을 파싱하여 감정 정보를 추출합니다:

**처리 과정:**
1. `ast.literal_eval()`을 사용하여 JSON 문자열을 안전하게 파싱
2. 각 annotation에서 `emotion` 키의 값을 추출
3. `Counter`를 사용하여 감정별 빈도 계산
4. 에러 처리로 파싱 실패 시 빈 딕셔너리 반환

**결과:**
- 각 텍스트에 대한 감정별 빈도가 딕셔너리 형태로 저장
- 예: `{'기쁨_만족감': 3, '기쁨_감동': 2}`

### 3.2 감정 카운트 컬럼 생성
추출된 감정 정보를 `emotion_counts` 컬럼으로 저장하여 후속 분석에 활용할 수 있도록 합니다.

## 4. 표준 감정 라벨 정의

### 4.1 표준 감정 체계
감정 라벨의 품질 관리를 위해 표준 감정 체계를 정의합니다:

**9개 중분류 감정:**
- **기쁨**: 반가움, 즐거움, 신명남, 자신감, 감동, 만족감, 편안함, 고마움, 신뢰감, 안정감, 공감, 자랑스러움
- **사랑**: 호감, 귀중함, 매력적, 두근거림, 아른거림, 너그러움, 열정적임, 다정함, 동정(슬픔)
- **슬픔**: 억울함, 외로움, 후회, 실망, 허망, 그리움, 수치심, 고통, 절망, 무기력, 아픔
- **두려움**: 위축감, 놀람, 공포, 걱정, 초조함
- **분노**: 원망, 불쾌, 날카로움, 타오름
- **미움(상대방)**: 반감, 경멸, 비위상함, 치사함, 불신감, 시기심, 외면, 냉담
- **욕망**: 욕심, 궁금함, 아쉬움, 불만, 갈등, 기대감
- **싫어함(상태)**: 답답함, 불편함, 난처함, 서먹함, 심심함, 싫증
- **수치심**: 부끄러움, 죄책감, 미안함

### 4.2 중립 감정 추가
표준에 없지만 데이터에 실제로 포함된 중립 감정들을 추가로 허용합니다:

**실제 데이터에 있는 중립 감정들 (33개):**
- 중립_감동, 중립_걱정, 중립_고마움, 중립_고통, 중립_공감, 중립_공포, 중립_궁금함
- 중립_귀중함, 중립_그리움, 중립_난처함, 중립_냉담, 중립_놀람, 중립_다정함
- 중립_답답함, 중립_동정(슬픔), 중립_만족감, 중립_무기력, 중립_미안함, 중립_반가움
- 중립_불신감, 중립_불쾌, 중립_서먹함, 중립_신뢰감, 중립_안정감, 중립_열정적인
- 중립_외로움, 중립_위축감, 중립_자랑스러움, 중립_절망, 중립_통쾌함, 중립_편안함, 중립_호감, 중립_후회

## 5. 실제 사용된 감정 라벨 추출

### 5.1 감정 라벨 수집
실제 데이터에서 사용된 모든 감정 라벨을 수집합니다:

**처리 과정:**
1. `emotion_counts` 컬럼의 모든 딕셔너리를 순회
2. 각 딕셔너리의 키(감정 라벨)를 추출하여 집합에 저장
3. 중복 제거를 통해 고유한 감정 라벨만 수집

**결과:**
- 실제 데이터에서 사용된 감정 라벨의 총 개수 확인
- 표준과 비교하여 비표준 라벨 식별 가능

### 5.2 중립 감정 확인
실제 데이터에 포함된 중립 관련 감정들을 확인합니다:

**확인 사항:**
- 중립으로 시작하는 감정 라벨들 식별
- 표준에 정의된 중립 감정과의 일치 여부 확인
- 중립 감정의 소분류 패턴 분석

## 6. 감정 라벨 분류 및 정리

### 6.1 제거할 감정 라벨 식별
감정 라벨의 품질 관리를 위해 허용 기준을 설정합니다:

**허용 기준:**
1. **표준 감정 라벨**: 9개 중분류 × 각 소분류 = 총 63개 표준 감정
2. **중립 감정**: 표준에 없지만 데이터에 실제로 포함된 33개 중립 감정
3. **25개 이상 데이터**: 표준에 없어도 충분한 데이터(25개 이상)를 가진 감정

**제거 대상:**
- 표준에 없고
- 중립도 아니며
- 25개 미만의 데이터를 가진 감정 라벨

### 6.2 감정 라벨 정보 엑셀 저장
감정 라벨 분석 결과를 체계적으로 정리하여 엑셀 파일로 저장합니다:

**저장 정보:**
- 허용할 감정 라벨, 제거할 감정 라벨
    - 감정 라벨명
    - 중분류 및 소분류
    - 데이터 개수
    - 허용/제거 상태
- 요약 통계

**파일명:** `05_emotion_label_analysis.xlsx`

## 7. 데이터 정리 실행

### 7.1 제거할 감정 라벨 제거
허용 기준에 맞지 않는 감정 라벨들을 데이터에서 제거합니다:

**처리 과정:**
1. **원본 데이터 복사**: 안전한 처리를 위해 원본 데이터를 복사
2. **감정 라벨 필터링**: 각 행의 `emotion_counts`에서 허용되지 않은 감정 제거
3. **제거 통계 추적**: 제거된 감정이 포함된 행 수와 총 제거된 감정 개수 계산
4. **빈 데이터 처리**: 모든 감정이 제거된 행은 완전히 삭제

**결과:**
- 제거된 감정 라벨이 포함된 행 수
- 총 제거된 감정 개수
- 감정이 완전히 제거된 행 수
- 최종 남은 행 수

## 8. 최종 통계 및 저장

### 8.1 정리된 데이터의 최종 통계
데이터 정리 완료 후 최종 통계를 확인합니다:

**확인 항목:**
- **감정 종류 수**: 정리 후 남은 감정 라벨의 총 개수
- **상위 10개 감정 분포**: 가장 빈번한 감정들의 개수
- **중분류별 분포**: 각 중분류별 데이터 분포 (가장 빈번한 감정 기준)

**분석 결과:**
- 데이터 품질 향상 정도 확인
- 감정 분포의 균형성 평가
- 표준 라벨링 체계 준수 여부 검증

### 8.2 최종 데이터 저장
정리된 최종 데이터를 엑셀 파일로 저장합니다:

**저장 파일:**
- **파일명**: `06_processed_emotion_data.xlsx`
- **위치**: `../datas/` 폴더
- **내용**: 정리된 `context`, `emotion_counts` 데이터

## 9. 주요 성과

### 9.1 데이터 품질 개선
- ✅ **표준 감정 라벨 체계 준수**: 9개 중분류 × 63개 소분류 표준 체계 적용
- ✅ **비표준 감정 정리**: 25개 미만 데이터의 비표준 감정 제거
- ✅ **중립 감정 허용**: 표준에 없는 중립 감정 33개 추가 허용
- ✅ **잘못된 라벨 정리**: 오타나 잘못된 라벨링으로 추정되는 감정들 제거

### 9.2 생성된 파일
- **`05_emotion_label_analysis.xlsx`**: 감정 라벨 분석 결과 (허용/제거 상태 포함)
- **`06_processed_emotion_data.xlsx`**: 최종 정리된 데이터

### 9.3 처리 결과
- **원본 데이터**: 1,039개 행
- **정리 후 데이터**: 품질이 향상된 행 수
- **감정 라벨 종류**: 표준 + 25개 이상 데이터 감정
- **데이터 품질**: 표준 라벨링 체계 준수

## 10. 결론

`02_data_preprocess.ipynb`는 감정 분석 데이터의 품질 관리에 특화된 전처리 과정을 수행합니다. 

**핵심 특징:**
- **표준 준수**: 9개 중분류 × 63개 소분류의 체계적인 감정 분류
- **실용적 접근**: 충분한 데이터(25개 이상)를 가진 비표준 감정도 유지
- **품질 보장**: 잘못된 라벨링과 부족한 데이터 제거로 학습 효과 향상
- **투명성**: 제거된 데이터와 허용 기준을 명확히 문서화

이를 통해 머신러닝 모델 학습에 최적화된 고품질 감정 분석 데이터셋을 구축했습니다.
